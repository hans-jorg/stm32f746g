USB
===


Introduction
------------

The STM32F746G has an on chip USB controller (OTG_FS/OTG_HS).

This controller has the following features:

* High speed (480 Mbps)
* Full Speed (12 Mbps)
* Support for On The Go (OTG), i.e., discovery at run time if it is a device or a host)
* It can work as a device-only or as host-only or as a OTG
* Two interfaces: Full Speed and High Speed.

> It does not work as a Low Speed (1.5 Mbps) device, but it can work as a Low Speed host

The STM32F746G Discovery Board
------------------------------


### Full Speed Interface

The Full Speed Interface uses a EMIF02-USB03 EMI filter and a STMPS2141STR Power Switch and a USB AB Connector (CN13).

| Board signal 	|                      | Pin   | Connector | Description                          |
|---------------|----------------------|-------------------|--------------------------------------|
| USB_FS1_ID 	| OTG_FS_ID            |  PA10 | CN13-4    | ID                                   |
| USB_FS1_N 	| OTG_FS_N             |  PA11 | CN13-2    | Data Minus                           |
| USB_FS1_P 	| OTG_FS_P             |  PA12 | CN13-3    | Data Plus                            |
| 5V_USB_FS     | OTG_FS_VBUS          |  PJ12 | CN13-1    | VBUS                                 |
|               | OTG_FS_PowerSwitchOn |  PD5  |           |                                      |
|               | OTG_FS_OverCurrent   |  PD4  |           | 

There is a red led (LD6), that indicates overcurrent and a green LED (LD5), that indicate powering of the interface. The overcurrent signal is generated by the STMPS2141 Power Switch.


### High Speed interface

The High Speed Interface uses a Microchip USB3320C-EZK Transceiver, a STMPS2151 Power Switch, an ON Semiconductor ESD7383NCTBG ESD Protection.

The USB3320 uses a 24 MHz clock signal

| Board signal      |  USB3320 Pin |  SMT32F746NG Pin |  Description              |
|-------------------|--------------|------------------|---------------------------|
| USB_HS_N          |     DM       |                  | Data minus                |
| USB_HS_P          |     DP       |                  | Data plus                 |
| USB_HS_VBUS       |    VBUS      |                  | Vbus                      |
|                   |      ID      |                  | ID                        |
|  ULPI_CK          | CLOCKOUT     |       PA5        | Clockout from Transceiver |
|  ULPI_STP         |    STP       |       PC0        |                           |
|  ULPI_DIR         |    DIR       |       PC2        |                           |
|  ULPI_NXT         |    NXT       |       PH4        |                           |
|  ULPI_D0          |    D0        |       PA3        | Data line #0              |
|  ULPI_D1          |    D1        |       PB0        | Data line #1              |
|  ULPI_D2          |    D2        |       PB1        | Data line #2              |
|  ULPI_D3          |    D3        |       PB10       | Data line #3              |
|  ULPI_D4          |    D4        |       PB11       | Data line #4              |
|  ULPI_D5          |    D5        |       PB12       | Data line #5              |
|  ULPI_D6          |    D6        |       PB13       | Data line #6              |
|  ULPI_D7          |    D7        |       PB5        | Data line #7              |
| OTG_HS_Overcurrent|              |       PE3        | Overcurrent               |


The USB3320 interface uses a 24 MHz clock signal from an oscillator. It is shared with the camera connector. 

There is a red LED (LD3) to indicate overcurrent, driven by the STMPS2151STR and a green LED (LD4)
driven by the USB3320 transceiver (VUSB signal) to indicate powering of the interface.












References
----------

3. [STM32F75xxx and STM32F74xxx advanced Arm Â® -based 32-bit MCUs Reference Manual - RM0385](https://www.st.com/resource/en/reference_manual/dm00124865-stm32f75xxx-and-stm32f74xxx-advanced-arm-based-32-bit-mcus-stmicroelectronics.pdf)
1. [EMIF02-USB03F2: 2-line EMI filter and ESD protection with R pull-up for USB interfaces](https://www.st.com/resource/en/datasheet/emif02-usb03f2.pdf)
2. [STMPS2141: Enhanced single channel power switches](https://www.st.com/resource/en/datasheet/stmps2141.pdf)
3. [STMPS2151:Enhanced single channel power switches](https://www.st.com/resource/en/datasheet/stmps2151.pdf)
2. [USB3320 Highly Integrated Full Featured Hi-Speed USB 2.0 ULPI Transceiver Data](https://www.microchip.com/en-us/product/USB3320)



